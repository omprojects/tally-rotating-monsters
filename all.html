<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Tally Product Monsters</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600&display=swap" rel="stylesheet">
	<style>
		html,
		body {
			background: #461899;

			background: rgb(81, 30, 162);
			background: linear-gradient(0deg, rgba(81, 30, 162, 1) 0%, rgba(105, 40, 155, 1) 48%, rgba(81, 30, 162, 1) 100%);

			font-family: 'Source Sans Pro', sans-serif;
			width: 100%;
			margin: 0;
			height: 100%;
			color: white;
		}

		.name {
			font-size: 1rem;
			line-height: normal;
		}

		.taxonomy {
			color: white;
			font-size: 1rem;
		}


		.monster-wrapper {
			padding: 30px;
		}

		.monster {
			width: 250px;
		}

		.monster-sprite {
			height: 200px;
			background: url('') left center no-repeat;
			animation: monster-keyframes 0.4s steps(3) infinite;
		}

		@keyframes monster-keyframes {
			100% {
				background-position: -750px;
			}
		}
	</style>

</head>

<body>

	<div class="container-fluid"></div>



	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>


	<script type="text/javascript" src="assets/js/functions.js"></script>
	<script type="text/javascript" src="data/monsters-by-id.js"></script>
	<script type="text/javascript" src="data/palettes-by-name.js"></script>
	<script type="text/javascript" src="data/palettes-by-tier1id.js"></script>
	<script type="text/javascript" src="data/gradients-by-mid.js"></script>

	<script>
		var timer, newMonster, oldMonster, row = 1,
			col = 1,
			colMax = 8,
			currentMonster = {},
			currentMid = 0;

		$(document).ready(function() {
			addMonsters();
		});

		function addMonsters() {
			let str = '';
			for (var key in MonstersById.data) {

				currentMid = key;
				currentMonster = MonstersById.data[key];

				// only do the best
				if (parseInt(currentMonster.status) !== 2) continue;

				let palette = {},
					paletteArr = [];

				// if palette set in monster then use it
				if (prop(PalettesByName.data[currentMonster.palette])) {
			        palette = PalettesByName.data[currentMonster.palette];
					paletteArr = palette.hex;
				}
				// else look to see if parent is set
				else if (prop(PalettesByTier1Id.data[currentMonster.tier1id])) {
			        palette = PalettesByTier1Id.data[currentMonster.tier1id];
					paletteArr = palette.hex;
				}

				// display each 6 times
				for (let i = 0; i < 12; i++) {

					// should we add new row?
					if (col === 1) {
						str += '<div class="row">' + "\n\n"; // new row
					}
					if (col >= 1) {
						str += '<div class="col">' + "\n\n"; // new col
					}


					let gradient = {},
						gradientArr = [],
						gradientStr = "";

					// is the gradient id saved in the monster data?
					if (i ==0 && currentMonster.gradient && GradientsByMid.data[currentMonster.gradient]) {
						gradient = GradientsByMid.data[currentMonster.gradient];
						gradientArr = gradient.hex.split(",");
						gradientStr = "border: 5px solid #000;"
					}
					// or is the mid in the gradient IDs?
					else if (i ==0 && GradientsByMid.data[currentMid] && GradientsByMid.data[currentMid].hex) {
						gradient = GradientsByMid.data[currentMid];
						gradientArr = gradient.hex.split(",");
						gradientStr = "border: 5px solid #000;"
					} else {
						// get random
						//let gradient = returnGradientArr(palette,"");
						gradient = returnGradientArr(paletteArr, "random");
					}
					// create gradient
					gradientStr += "background: linear-gradient(0deg, " +
						gradient[0] + " 0%," +
						gradient[1] + " 45%," +
						gradient[0] + " 100%);"



					str += "<div class='monster-wrapper' style='" + gradientStr + "'>";
					str += '<div class="monster align-items-center">';
					str += '<div class="monster-sprite" style="background-image:url(monsters-200h/' + currentMonster.mid + '-anim-sheet.png)"></div>';
					str += '</div>';
					str += '</div>'; // /monster-wrapper

					str += '<div class="taxonomy">' + returnTaxonomy(currentMonster,palette) +
						' <br>mid=' + key +
						', status=' + currentMonster.status +
						', gradient=' + returnGradientStr(gradient) + '</div>';
					// str += "<p>" + JSON.stringify(currentMonster) + "</p>";
					//str += "<p>" + JSON.stringify(palette) + "</p>";
					str += "<p>" + returnPaletteBoxes(paletteArr) + "</p>";





					//console.log(currentMonster.mid, currentMonster.status, currentMonster);



					str += "</div>\n\n"; // /column

					// check cols
					if (++col > colMax) {
						col = 1;
						str += "</div>\n\n"; // /previous row
					}
				}
			}
			// clean up any unfinished columns
			if (col < colMax) {
				while (col < colMax) {
					str += '<div class="col"></div>';
					col++;
				}
				str += "</div>\n\n"; // /last row
			}

			$('.container-fluid').html(str);
		}
	</script>

</body>

</html>
